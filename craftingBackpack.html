<!--
HEWWO?!!
-->
<script>
  var itemArray = [];
  var craftedItemArray = [];
  var badID = [17731,24998,17733,7158,17735,17737,17739,7033,1828,161,6122,157,1828,1856,1860,1888,164,4459,6036,5565,20658,20887,20888,20889,20891, 20891,20892,18270,11155,11162,11169,11176,11183,11190,22960,24058];
  function item(name, amount, iconID)
  {
    this.name = name,
    //this.itemID = itemID,
    //this.recipeID = recipeID,
    this.amount = amount,
    this.iconID = iconID
  }
  function craftedItem(name, amount, iconID)
  {
    this.name = name,
    this.amount = amount,
    this.iconID = iconID
  }
  function makeCalls()
  {
  document.getElementById("displayList").innerHTML = "";
  //The result that comes back now has .GameContentLinks.Recipe.ItemResult[]
  var x = "https://xivapi.com/search?string=" + document.getElementById("inputText").value + "&indexes=item&columns=ID,Name,Icon,GameContentLinks";
  fetch(x, { mode: 'cors' })
  	.then(response => response.json())
    .then(data => displayItems(data.Results));
  }
  var idArray = [];
  function displayItems(id)
  {
    var badName = ["Lominsan"," Aetherial Iron Lance","Dated"];
    id = id.filter(id => !!id.GameContentLinks);
    id = id.filter(id => !badID.includes(id.ID));
    id = id.filter(id => !!id.GameContentLinks.Recipe);
    id = id.filter(id => !!id.GameContentLinks.Recipe.ItemResult);
    var y = document.getElementById("amtSelect").value;
    for (var i = 0; i < y;i++)
    {
      console.log(id[i]);
      writeItems(id[i].GameContentLinks.Recipe.ItemResult, i, id[i].Name,id[i].Icon);
    }
  }

  function adjustFont(name)
  {
    var str = "font-size:";
    var newStr;
    var newerStr = name.split(" ");
    for (i=0; i < newerStr.length;i++)
    {
      if (newerStr[i].length >= 9)
      {
        newerStr[i] = newerStr[i] + "<br>";
      }
      else
      {

      }
    }
    console.log(newerStr[0]);
    if (newerStr.length === 1)
    {
      newStr = name;
    }
    if (newerStr.length === 2)
    {
      newStr = newerStr[0] + " " + newerStr[1];
    }
    if (newerStr.length === 3)
    {
      newStr = newerStr[0] + "<br>" + newerStr[1] + " " + newerStr[2];
    }
    if (newerStr.length === 4)
    {
      newStr = newerStr[0] + " " + newerStr[1] + "<br>" + newerStr[2] + " " + newerStr[3];
    }


    return newStr;
  }

  function writeItems(itemData, i, name, icon)
  {
    console.log(i);
    console.log(name);
    console.log(itemData);
    console.log(icon);
    var iconPath = "https://xivapi.com" + icon;
    var objName = document.createElement('h1');
    objName.style="float:left;font-size:15px;padding-left:5px;margin-top:0px;margin-bottom:20px;color: black;font-family: 'PT Sans', sans-serif;";
    //container.appendChild(name);
    var nameText = document.createTextNode(name);
    objName.innerHTML = adjustFont(name);
    //name.appendChild(nameText);

    document.getElementById("displayList").innerHTML += "<button id="+itemData+" onClick=displayItemButton("+itemData+");>" + "</button>";
    var x = document.createElement('IMG');
    x.classList.add('img');
    x.style="float:left;margin-top:0px;";
    x.src = "https://xivapi.com" + icon;
    document.getElementById(itemData).appendChild(x);
    document.getElementById(itemData).appendChild(objName);
  }
  function displayItemButton(id)
  {
    var x = "https://xivapi.com/recipe/" + id;
    fetch(x, { mode: 'cors' })
    	.then(response => response.json())
      .then(data => printList(data));
  }
  function printList(data)
  {
    searchNum = craftedItemArray.findIndex(i => i.name === data.Name);
    if (searchNum === -1)
    {
      var newCraftedItem = new craftedItem(data.Name, 1, data.Icon);
      craftedItemArray.push(newCraftedItem);
      searchNum = null;
      displayAllCraftedItems(data);
    }
    else
    {
      //console.log("Increment?");
      incrementCraftedItems(searchNum);
    }
    console.log(data);
    if (data.AmountIngredient0 != 0)
    {
      updateArray(data.ItemIngredient0.Name, data.AmountIngredient0, data.ItemIngredient0.Icon);
    }
    if (data.AmountIngredient1 != 0)
    {
      updateArray(data.ItemIngredient1.Name, data.AmountIngredient1, data.ItemIngredient1.Icon);
    }
    if (data.AmountIngredient2 != 0)
    {
      updateArray(data.ItemIngredient2.Name, data.AmountIngredient2, data.ItemIngredient2.Icon);
    }
    if (data.AmountIngredient3 != 0)
    {
      updateArray(data.ItemIngredient3.Name, data.AmountIngredient3,  data.ItemIngredient3.Icon);
    }
    if (data.AmountIngredient4 != 0)
    {
      updateArray(data.ItemIngredient4.Name, data.AmountIngredient4,  data.ItemIngredient4.Icon);
    }
    if (data.AmountIngredient5 != 0)
    {
      updateArray(data.ItemIngredient5.Name, data.AmountIngredient5,  data.ItemIngredient5.Icon);
    }
    else
    {
    }
  }
  function updateArray(name,amount,icon)
  {
    //document.getElementById("displayList").innerHTML = ""
    var searchNum = null;
    searchNum = itemArray.findIndex(i => i.name === name);
    if (searchNum === -1)
    {
      var newItem = new item(name, amount, icon);
      itemArray.push(newItem);
      searchNum = itemArray.findIndex(i => i.name === name);
      displayAllItems(searchNum);
    }
    else
    {
      itemArray[searchNum].amount += amount;
      incrementItems(searchNum);
    }
  }
  function incrementItems(searchNum)
  {
    var itemName = itemArray[searchNum].name;
    var x = document.getElementById('amount' + itemArray[searchNum].name);
    x.innerHTML = itemArray[searchNum].amount;
  }
  function incrementCraftedItems(searchNum)
  {
    console.log("Got to the incrementing Crafted Items func");
    craftedItemArray[searchNum].amount += 1;
    var itemName = craftedItemArray[searchNum].name;
    var x = document.getElementById('amount' + craftedItemArray[searchNum].name);
    x.innerHTML = craftedItemArray[searchNum].amount;
  }
  function displayAllItems(i)
  {
    var container = document.createElement('div');
    container.classList.add('container');
    var name = document.createElement('h1');
    name.id = 'name';
    var ID = itemArray[i].name;
    var amount = document.createElement('h1');
    amount.id = 'amount' + itemArray[i].name;
    var x = document.createElement('IMG');
    x.classList.add('img');
    x.style="float:left;width:6%;padding-top:3px;";
    x.src = "https://xivapi.com" + itemArray[i].iconID;
    var nameText = document.createTextNode(itemArray[i].name);
    var amountNum = document.createTextNode(itemArray[i].amount);

    var deleteButton = document.createElement('button');
    amount.style = "font-size: 15px;float:right;padding-right:15px;padding-top:8px;margin-top:0px;color: #EF948D;font-family: 'PT Sans', sans-serif;";
    name.style="font-size: 13px;float:left;padding-left:10px;margin-top:8px;color: #EF948D;font-family: 'PT Sans', sans-serif;";
    deleteButton.innerHTML = '<img src="xivImages/icons/status.png" style="width:15px;"/>';

    //eleteButton.style="width:20px;height:20px;float:right;padding:0px;margin-top:4px;display:inline-block;border-radius:15px;padding-left:14px;";
    deleteButton.style="width:20px;height:20px;padding-left:20px;float:right;padding:0px;margin-top:5px;border-radius:15px;";




    deleteButton.addEventListener('click', () => { deleteItem(ID); })
    name.appendChild(nameText);
    amount.appendChild(amountNum);
    container.appendChild(x);
    container.appendChild(name);
    container.appendChild(deleteButton);
    container.appendChild(amount);

    container.id = itemArray[i].name;
    container.style = "padding-top:2px;font-size:12px;background-color:#cc5d49;margin-top:5px;margin-bottom:5px;height:30px;padding:0px;padding-left:10px;";
   document.getElementById("displayIconList").appendChild(container);
  }
  function deleteItem(id)
  {
    console.log(id);
    var searchNum = null;
    console.log(itemArray);
    searchNum = itemArray.findIndex(i => i.name === id);
    console.log(searchNum);
    if (searchNum === -1)
    {
    }
    else
    {
      itemArray.splice(searchNum,1);
      document.getElementById(id).remove();
    }
  }
  function deleteCItem(id)
  {
    console.log(id);
    var searchNum = null;
    searchNum = craftedItemArray.findIndex(i => i.name === id);
    console.log(searchNum);
    if (searchNum === -1)
    {
    }
    else
    {
      craftedItemArray.splice(searchNum,1);
      document.getElementById(id).remove();
    }
  }
  function displayAllCraftedItems(i)
  {
    var container = document.createElement('div');
    container.classList.add('container');
    var name = document.createElement('h1');
    name.id = 'name';
    var amount = document.createElement('h1');

    amount.style = "font-size: 18px;float:right;margin-top:20x;color:#F29D2C;font-family: 'PT Sans', sans-serif;padding-right:13px;";
    name.style="font-size: 18px;float:left;padding-left:10px;margin-top:20px;color:#F29D2C;font-family: 'PT Sans', sans-serif;";

    amount.id = 'amount' + i.Name;
    var x = document.createElement('IMG');
    x.classList.add('img');
    x.style="float:left;margin-top:10px;margin-left: 10px;";
    x.src = "https://xivapi.com" + i.Icon;
    var nameText = document.createTextNode(i.Name);

    var deleteButton = document.createElement('button');
    deleteButton.innerHTML = '<img src="xivImages/icons/status.png" style="width:15px;position-right:20px;"/>';

    deleteButton.style="margin-left:0px;width:20px;height:20px;float:right;padding:0px;margin-top:20px;display:inline-block;border-radius:15px;";
    deleteButton.addEventListener('click', () => { deleteCItem(i.Name); })
    var amountNum = document.createTextNode(1);


    name.appendChild(nameText);
    amount.appendChild(amountNum);
    container.appendChild(x);
    container.appendChild(name);

    container.appendChild(deleteButton);
    container.appendChild(amount);

    container.id = i.Name;
    container.style = "margin-top:0%;font-size: 12px;margin-bottom:10px;padding:0px;";
    document.getElementById("displayIconList").appendChild(container);
  }
  </script>
  <style>
    body
    {
      background-color: #AA4A39;
      height: 100%;
    }
    body
    {
    }
    h1
    {
      font-size:12px;
    }
    .row
    {
      width: 390px;
    }
    .iconList
    {
    }
    button
    {
      width: 160px;
      height: auto;
      max-height: 50px;
      background-color: #FF7F67;
      border-color: #FE8D33;
    }
    #displayList
    {
      padding-left: 15px;
    }
    #displayList button
    {
      font-size: 14px;
      width: 170px;
      padding: 0px;
      margin: 5px;
    }
    #displayIconList
    {
    }
    #searchHeader
    {
      padding-left:10px;
    }
    #inputText
    {
      border-radius: 10px;
      height: 30px;
      width: 255px;

    }
    #amtSelect
    {
      width:40px;
      height: 30px;
      border-radius: 10px;
    }
    #amtDiv
    {
      width: 40px;
    }
    #searchBtn
    {
      margin-left: 5px;
      padding-left: 5px;
      width:55px;
      border-radius:5px;
      height: 30px;
      font-family: 'PT Sans', sans-serif;

    }
    #displayIconList
    {
      background-color: #AA4A39;
    }
    .removeButton
    {
      background-color: black;
    }
    #fishieboye
    {
      width: 200px;
    }
    #footer
    {
      padding-top: 315px;

    }

    #speechIcon
    {
      width: 180px;
      padding-top:20px;
    }
    #speechText
    {
      color: black;
      font-family: 'PT Sans', sans-serif;
      font-size: 12px;
      margin-left:30px;
      padding-top:5px;
    }
    #footerText
    {
      color: white;
      margin-top: 0px;
      font-family: 'PT Sans', sans-serif;
      font-size:12px;
      margin-left: 30px;
      padding-right: 0px;
    }
    #titleHeader
    {
      color: gold;
      font-size:42px;
      font-family: 'Unica One', cursive;
      padding-left: 40px;

    }
    #headerBG
    {
      background-color: #801515;
    }

    @media only screen and (width: 600px)
    {

    }
      </style>
    <head>
      <link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Unica+One" rel="stylesheet">

      <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>



    </head>
<body style="background-color: #88241C;">

  <!--
  <img src ="xivImages/icons/namazu-stroke.png" class="overlay"/>

  <img src = "xivImages/blackgradient.png" class="bg"/>
  <div class = "squareBG" />
-->
<!--
  iPhone X - 375x812
  iPad - 768x1024
  Galaxy S5 - 360x640
  -->
  <div class="container-fluid">
    <div class = "row" style="background-color: #661010;">
      <h2 id = "titleHeader">Namazu Backpack</h2>
      </div>
    <div class ="row" id="searchHeader">
      <div class = "col-xs-8" style="padding:5px;">
        <input id="inputText" placeholder="i.e. Hingan Sofa, Lumber"></input>
        </div>
        <div class = "col-xs-2"  style="padding:5px; padding-left:10px;" id ="amtDiv">
          <select id="amtSelect">
            <option value="6">6</option>
            <option value="12">12</option>
            <option value="18">18</option>
            <option value="30">30</option>
          </select>
          </div>
          <div class = "col-xs-2" style="padding:5px;padding-left:10px;">
            <button onclick="makeCalls()" id="searchBtn">Search</button>
            </div>
            </div>
          <div class = "row">
            <div id ="displayList"></div>

            </div>
            <div class = "row">
              <div id ="displayIconList"></div>

              <div id ="craftedList"></div>
          </div>
        </div>
      <div class ="row" id = "footer">
        <div class = "col-xs-5">
          <div class = "image" style="position:relative;width:100%;">
              <img src ="xivImages/icons/speech.png" id = "speechIcon">
              <h2 style="position:absolute;top:10px;left:0;width:100%;" id="speechText"><span>Still a work in progress, yes yes!</span></h2>
              <h2 id="footerText"><span>If an item appears as undefined, please message Jamie#6288 on Discord!</span></h2>

          </div>
          </div>
          <div class = "col-xs-7">
            <img src ="xivImages/icons/namazu-stroke.png" id="fishieboye"/>
            </div>
          </div>

      </div>
    </body>


            <!--
            <h2 style="font-size:16px;">Input the name of the item into the search bar. <br> The amount of returned objects is limited, so please be accurate. <br> Click search to pull up the craftable items.</h2>
            <h2 style="font-size:16px;">Clicking on an item will add it to your item list. You can click on an item as many times as you like!</h2>
            <h2 style="font-size:16px;">To look for a new set of items, just hit search again. You won't lose anything in your materials list.</h2>
            <h2 style="padding-top:50%;">"Working on it, yes yes!"</h2>
            <h2 style="font-size:16px;">"This site is new, and still a work in progress. Please be patient, as I am new to many aspects of this sort of development."</h2>
            <h2 style="font-size:16px;">"Also, because I do not have fingers, and it is very difficult to type with flippers, yes yes."</h2>
            -->
