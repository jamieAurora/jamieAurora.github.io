<!--
HEWWO?!!
-->
<script>

  var itemArray = [];
  var craftedItemArray = [];
  function item(name, amount, iconID)
  {
    this.name = name,
    //this.itemID = itemID,
    //this.recipeID = recipeID,
    this.amount = amount,
    this.iconID = iconID
  }
  function craftedItem(name, amount, iconID)
  {
    this.name = name,
    this.amount = amount,
    this.iconID = iconID
  }
  function makeCalls()
  {
  document.getElementById("displayList").innerHTML = "";
  var x = "https://xivapi.com/search?string=" + document.getElementById("inputText").value + "&indexes=item";
  fetch(x, { mode: 'cors' })
  	.then(response => response.json())
    .then(data => displayItems(data.Results));
  }
  var idArray = [];
  function displayItems(id)
  {
    for (var i = 0; i< id.length; i++)
    {
      var dataObject;
      //console.log(id[i].ID);
      var x = "https://xivapi.com/item/" + id[i].ID;
      //console.log(x);
      fetch(x, { mode: 'cors' })
        .then(response => response.json())
        .then(data => writeItems(data.GameContentLinks.Recipe.ItemResult[0],i,data.Name))
      }
      idArray[i] = id[i].ID;
      var tempVar = idArray[i];
  }
  function writeItems(itemData, i, name)
  {
    //document.getElementById("displayList").innerHTML = "";
    document.getElementById("displayList").innerHTML += "<button id="+itemData+" onClick=displayItemButton("+itemData+");>" + name + "</button>";
  }
  function displayItemButton(id)
  {
    //document.getElementById("craftedList").innerHTML += "<br>" + document.getElementById(id).innerHTML;
    console.log(id);
    var x = "https://xivapi.com/recipe/" + id;

    fetch(x, { mode: 'cors' })
    	.then(response => response.json())
      .then(data => printList(data));
  }
  function printList(data)
  {
    console.log(data.Name);
    console.log(craftedItemArray)
    searchNum = craftedItemArray.findIndex(i => i.name === name);
    if (searchNum = 'undefined')
    {
      console.log("Undefined!");
      var newCraftedItem = new craftedItem(data.Name, 1, data.Icon);
      craftedItemArray.push(newCraftedItem);
      searchNum = null;
      displayAllCraftedItems(data);
    }
    else
    {
      console.log("Increment?");
      incrementCraftedItems(searchNum);
    }
    console.log(data);
    if (data.AmountIngredient0 != 0)
    {
      updateArray(data.ItemIngredient0.Name, data.AmountIngredient0, data.ItemIngredient0.Icon);
    }
    if (data.AmountIngredient1 != 0)
    {
      updateArray(data.ItemIngredient1.Name, data.AmountIngredient1, data.ItemIngredient1.Icon);
    }
    if (data.AmountIngredient2 != 0)
    {
      updateArray(data.ItemIngredient2.Name, data.AmountIngredient2, data.ItemIngredient2.Icon);
    }
    if (data.AmountIngredient3 != 0)
    {
      updateArray(data.ItemIngredient3.Name, data.AmountIngredient3,  data.ItemIngredient3.Icon);
    }
    if (data.AmountIngredient4 != 0)
    {
      updateArray(data.ItemIngredient4.Name, data.AmountIngredient4,  data.ItemIngredient4.Icon);
    }
    if (data.AmountIngredient5 != 0)
    {
      updateArray(data.ItemIngredient5.Name, data.AmountIngredient5,  data.ItemIngredient5.Icon);
    }
    else
    {
    }
  }
  function updateArray(name,amount,icon)
  {
    document.getElementById("displayList").innerHTML = ""
    var searchNum = null;
    searchNum = itemArray.findIndex(i => i.name === name);
    if (searchNum === -1)
    {
      var newItem = new item(name, amount, icon);
      itemArray.push(newItem);
      searchNum = itemArray.findIndex(i => i.name === name);
      displayAllItems(searchNum);
    }
    else
    {
      itemArray[searchNum].amount += amount;
      incrementItems(searchNum);
    }
  }
  function incrementItems(searchNum)
  {
    var itemName = itemArray[searchNum].name;
    var x = document.getElementById('amount' + itemArray[searchNum].name);
    x.innerHTML = itemArray[searchNum].amount;
  }
  function incrementCraftedItems(searchNum)
  {
    console.log("Got to the incrementing Crafted Items func");
    craftedItemArray[searchNum].amount += 1;
    var itemName = craftedItemArray[searchNum].name;
    var x = document.getElementById('amount' + craftedItemArray[searchNum].name);
    x.innerHTML = craftedItemArray[searchNum].amount;
  }
  function displayAllItems(i)
  {
    var container = document.createElement('div');
    container.classList.add('container');
    var name = document.createElement('h1');
    name.style="font-size: 20px;float:left;margin-top:5px;padding-right:10px;";
    name.id = 'name';
    var ID = itemArray[i].name;
    var amount = document.createElement('h1');
    amount.style = "font-size: 30px;float:left;margin-top:0px;padding-right:5px;";
    amount.id = 'amount' + itemArray[i].name;
    var x = document.createElement('IMG');
    x.classList.add('img');
    x.style="float:left;";
    x.src = "https://xivapi.com" + itemArray[i].iconID;
    var nameText = document.createTextNode(itemArray[i].name);
    var amountNum = document.createTextNode(itemArray[i].amount);
    name.appendChild(nameText);
    amount.appendChild(amountNum);
    container.appendChild(name);
    container.appendChild(amount);
    container.appendChild(x);
    container.id = itemArray[i].name;
    document.body.appendChild(container);
  }
  function displayAllCraftedItems(i)
  {
    var container = document.createElement('div');
    container.classList.add('container');
    var name = document.createElement('h1');
    name.style="font-size: 30px;float:left;margin-top:15px;padding-right:10px;";
    name.id = 'name';
    var amount = document.createElement('h1');
    amount.style = "font-size: 30px;float:left;margin-top:0px;padding-right:5px;";
    amount.id = 'amount' + i.Name;
    var x = document.createElement('IMG');
    x.classList.add('img');
    x.style="float:left;";
    x.src = "https://xivapi.com" + i.Icon;
    x.style="margin-top:15px;";
    var nameText = document.createTextNode(i.Name);
    var amountNum = document.createTextNode(i.Amount);
    name.appendChild(nameText);
    amount.appendChild(amountNum);
    container.appendChild(name);
    container.appendChild(amount);
    container.appendChild(x);
    container.id = i.Name;
    document.body.appendChild(container);
  }
  </script>
  <style>
    h1
    {
      font-size:12px;
    }
    </style>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<body>
  <h2 style="font-size:16px;">Search for an item, then click Find Me! <br>Clicking the item's button will tell you how many materials you need to craft it, <br> including one step down of sub-items (i.e. nuggets, ingots)</h2>
  <input id="inputText" style="margin-top:5%"></input>
  <button onclick="makeCalls()">Search</button>
  <div id ="displayList"></div>
  <h2 id="itemList">Material List</h2>
  <div class="container-fluid">
    <div class="row">
        <div class="col-sm-3" style="width:30px;">
          <div id ="displayIconList"></div>
          </div>
          <div class="col-sm-9" style="padding-left:5%;font-size:20px;line-height:40px;">
            <div id ="displayItemList"></div>
            </div>
      </div>
    </div>
  <div id ="craftedList"></div>
  <img src="xivImages/icons/namazu.jpg"/>
  <h1 style="font-size:12px;">Namazu are friends, not food!</h1>
  <h1 style="font-size:12px;">Now with icons!</h1>
  </body>
